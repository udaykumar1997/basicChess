"""## Library Imports & Model Loading"""

from flair.models import SequenceTagger
from flair.data import Sentence

from flask import Flask, jsonify
from flask import request

# import inflect

"""Load the pre-trained Flair NER (ontonotes-large) model"""

# tagger = SequenceTagger.load('ner')
# tagger = SequenceTagger.load('ner-large')
tagger = SequenceTagger.load('ner-ontonotes-large')

from transformers import RobertaTokenizer, RobertaForSequenceClassification
import torch, os

"""## Fine-Tuned RoBERTa for ERR"""

# tokenizer = RobertaTokenizer.from_pretrained('roberta-base')
# model = RobertaForSequenceClassification.from_pretrained('roberta-base', num_labels=3)  # 2 labels for binary classification

hf_token = os.getenv('HF_TOKEN')
url="udaykumar97/OASIS_RoBERTa_for_ERR_one"
tokenizer = RobertaTokenizer.from_pretrained(url, token=hf_token)
model = RobertaForSequenceClassification.from_pretrained(url, token=hf_token)

# Check if GPU is available and set the device accordingly
device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
# Move model to the selected device
model.to(device)

def classify_entities(input_text):
    if '[SEP]' not in input_text:
        # raise ValueError("Input must be formatted with [SEP] to separate parts. Don't include spaces")
        return "Input must be formatted with [SEP] to separate parts. Don't include spaces"

    if 'Which one of the following entities is non-redundant and worth retaining? [SEP]' not in input_text:
        input_text = 'Which one of the following entities is non-redundant and worth retaining?[SEP]' + input_text
    else:
        # raise ValueError("Please don't add the question in the input. It will be added automatically.")
        return "Please don't add the question in the input. It will be added automatically."

    trailing_option = "[SEP]neither are worth retaining[SEP]both are worth retaining"
    if trailing_option not in input_text:
        input_text = input_text + trailing_option
    else:
        # raise ValueError("Please don't add the 'neither' option in the input. It will be added automatically.")
        return "Please don't add the 'neither' option in the input. It will be added automatically."

    # Tokenize the input text
    inputs = tokenizer(input_text, return_tensors="pt", max_length=512, truncation=True, padding="max_length")
    inputs = {k: v.to(device) for k, v in inputs.items()}

    # Perform classification
    outputs = model(**inputs)
    logits = outputs.logits

    # Convert logits to probabilities using softmax
    probs = torch.softmax(logits, dim=1)

    # Determine the predicted class (0, 1, or 2)
    prediction = torch.argmax(probs, dim=1).item()

    # Split the input text to extract entities
    parts = input_text.split('[SEP]')
    # Adjust the indexing based on your model's prediction
    result = parts[prediction + 1]  # +1 because index 0 is the question

    return result

"""## Taxonomy Assignment Module (TAM) Code Block"""

def programatic_taxonomy_detection(text, taxonomy_list):
    results = []
    for term in taxonomy_list:
        start = 0
        while True:
            start = text.find(term, start)
            if start == -1:
                break
            end = start + len(term)
            results.append({"Text": term, "Type": taxonomy_list[0], "BeginOffset": start, "EndOffset": end})
            start += len(term)  # Move start index beyond the current word to avoid overlapping matches
    return results

# custom_taxonomies = ["startup_taxonomy", "ifc_taxonomies_taxonomy", "energy_taxonomy", "federal_health_taxonomy", "disaster_management_taxonomy", "climate_taxonomy", "transportation_taxonomy", "environment_taxonomy", "aviation_taxonomy", "data_analytics_taxonomy", "generative_ai_taxonomy", "cyber_security_taxonomy", "regulatory_policy_taxonomy", "enterprise_cloud_solutions_taxonomy", "research_evaluation_taxonomy", "advisory_taxonomy", "public_health_taxonomy"]

# custom_taxonomy_name = ['startup', 'business incubator', 'co-founder', 'Liberty Mutual Fire Insurance Company', 'equity crowdfunding']
# startup_taxonomy = ['startup', 'business', 'private equity', 'exit strategy', 'burn rate', 'team building', 'performance review', 'valuation cap', 'edtech', 'early-stage startup', 'customer segmentation', 'startup pitch', 'skills training', 'incorporation', 'customer acquisition', 'customer retention', 'trademark registration', 'business plan', 'ipo', 'marketing strategy', 'co-working space', 'market fit', 'venture funding', 'social media strategy', 'angel investor', 'user experience (ux)', 'pivot', 'business accelerator', 'fintech', 'non-disclosure agreement (nda)', 'product launch', 'patent filing', 'leadership', 'equity', 'startup valuation', 'mezzanine financing', 'startup accelerator', 'business model', 'corporation', 'infrastructure as a service (iaas)', 'break-even point', 'late-stage startup', 'proptech', 'software as a service (saas)', 'market disruption', 'run rate', 'market analysis', 'networking events', 'regulatory compliance', 'cap table', 'due diligence', 'management', 'capital raise', 'startup mentor', 'series a/b/c funding', 'scaling', 'minimal viable product (mvp)', 'venture capitalist', 'user acquisition', 'revenue model', 'series c funding', 'term sheet', 'entrepreneurship', 'startup law', 'startup office', 'startup ecosystem', 'series d funding', 'prototype', 'patent', 'venture capital', 'series b funding', 'startup advisor', 'advisor', 'profit margin', 'family and friends round', 'remote work', 'funding round', 'accelerator', 'value proposition', 'board member', 'sales strategy', 'equity stake', 'debt financing', 'platform as a service (paas)', 'startup incubator', 'product development', 'tech stack', 'y combinator', 'proof of concept', 'pitch deck', 'vesting schedule', 'disruptive technology', 'limited partner', 'mvp (minimum viable product)', 'startup competition', 'series a funding', 'mvp', 'bootstrapping', 'staff development', 'venture partner', 'angel round', 'employee hiring', 'sweat equity', 'venture round', 'shareholder agreement', 'seed capital', 'financial model', 'incubator', 'contract negotiation', 'healthtech', 'data privacy', 'pitch competition', 'entrepreneur', 'convertible note', 'innovation', 'growth capital', 'pre-seed funding', 'crowdfunding', 'shares', 'seed round', 'stock options', 'unique selling proposition (usp)', 'competitive analysis', 'traction', 'limited liability company (llc)', 'talent acquisition', 'intellectual property (ip)', 'revenue-based financing', 'startup culture', 'equity financing', 'digital marketing', 'industry conference', 'employment agreement', 'fundraising', 'corporate governance', 'seed funding', 'growth hacking', 'venture debt', 'trademark', 'angel funding', 'partnership', 'business development', 'founder', 'minimum viable product', 'series e funding', 'serial entrepreneur', 'general partner', 'demo day', 'intellectual property rights', 'startup community', 'lean startup', 'go-to-market strategy', 'organizational culture', 'techstars', 'greentech', 'user interface (ui)', 'equity crowdfunding', 'engineer', 'scientist', 'investor']
# ifc_taxonomies_taxonomy = ["ifc taxonomies", "federal it modernization", "cloud computing", "virtualization", "data center consolidation", "cybersecurity", "agile development", "devops", "containerization", "microservices", "blockchain technology", "artificial intelligence", "ai", "machine learning", "robotic process automation", "rpa", "internet of things", "iot", "big data analytics", "data governance", "data integration", "open data", "geospatial data", "api management", "mobile application development", "user-centered design", "enterprise architecture", "it infrastructure optimization", "software defined networking", "sdn", "edge computing", "quantum computing", "5g network integration", "it service management", "itsm", "identity and access management", "iam", "continuous monitoring", "incident response", "risk management framework", "rmf", "governance, risk, and compliance", "grc", "it procurement and acquisition", "legacy system modernization", "digital transformation", "citizen-centric services", "open source software adoption", "secure coding practices", "performance engineering", "scalability and elasticity", "disaster recovery planning", "knowledge management", "change management", "it budgeting and cost management", "vendor management", "business process reengineering", "regulatory compliance", "it skills development", "sustainability in it operations"]
# energy_taxonomy = ["energy", "renewable energy", "solar power", "wind energy", "hydropower", "biomass energy", "geothermal energy", "energy efficiency", "smart grids", "energy storage", "battery technologies", "electric vehicles", "evs", "grid modernization", "distributed energy resources", "ders", "microgrids", "energy management systems", "ems", "demand response", "energy conservation", "energy audits", "energy policy", "energy economics", "energy markets", "energy trading", "power generation", "natural gas", "oil and gas exploration", "shale gas", "lng", "liquefied natural gas", "coal and coal technologies", "nuclear power", "carbon capture and storage", "ccs", "carbon pricing", "energy transition", "energy infrastructure", "energy security", "energy independence", "energy resilience", "energy access", "renewable portfolio standards", "rps", "energy regulatory framework", "energy consumption patterns", "energy demand forecasting", "energy supply chain", "energy innovation", "energy financing", "energy risk management", "energy governance", "energy diplomacy", "energy justice", "sustainable energy", "energy education and awareness"]
# federal_health_taxonomy = ["federal health", "clinical modification", "cpt codes", "current procedural terminology", "hcpcs codes", "healthcare common procedure coding system", "drgs", "diagnosis-related groups", "ndc codes", "national drug codes", "medicare part a/b/c/d", "medicare program parts", "hipaa", "health insurance portability and accountability act", "hhs", "department of health and human services", "fda", "food and drug administration", "cdc", "centers for disease control and prevention", "nih", "national institutes of health", "cms", "centers for medicare & medicaid services", "pqrs", "physician quality reporting system", "ehr", "electronic health records", "phi", "protected health information", "hitech act", "health information technology for economic and clinical health act", "macra", "medicare access and chip reauthorization act", "aco", "accountable care organization", "bpci", "bundled payments for care improvement", "fqhc", "federally qualified health center", "pdp", "prescription drug plan", "under medicare part d", "hmo", "health maintenance organization", "ppo", "preferred provider organization", "medicaid waivers", "various medicaid waiver programs", "chip", "children's health insurance program", "vbp", "value-based purchasing", "mips", "merit-based incentive payment system", "qpp", "quality payment program", "340b program", "drug pricing program", "cobra", "consolidated omnibus budget reconciliation act", "health insurance continuation", "ihs", "indian health service", "va health system", "veterans affairs health services", "snf", "skilled nursing facility", "home health services", "medicare-covered home health services", "mental health parity act", "legislation related to mental health coverage", "long-term care", "various services and facilities", "telehealth", "remote healthcare services", "ambulatory surgical centers", "outpatient surgical facilities", "health disparities", "differences in health outcomes among populations", "health literacy", "understanding of health information", "population health", "health outcomes of a group of individuals", "social determinants of health", "economic and social factors influencing health", "health equity", "equal access to healthcare services", "health information exchange", "sharing of electronic health information", "opioid epidemic", "crisis related to opioid misuse", "healthcare fraud", "illegal practices in the healthcare system", "patient safety", "measures to prevent harm in healthcare settings", "public health emergency preparedness", "readiness for health emergencies", "healthcare quality measures", "standards to assess healthcare performance", "healthcare financing", "funding mechanisms for healthcare services"]
# disaster_management_taxonomy = ["disaster management", "natural disasters", "man-made disasters", "hazards", "risk assessment", "vulnerability", "resilience", "emergency response", "disaster recovery", "disaster mitigation", "incident command system", "ics", "emergency operations center", "eoc", "national response framework", "nrf", "disaster declaration", "evacuation", "shelter management", "mass care", "mass casualty incident", "mci", "search and rescue", "sar", "damage assessment", "critical infrastructure", "public health emergency", "medical surge", "triage", "psychological first aid", "pfa", "disaster communications", "community resilience", "social vulnerability", "climate change adaptation", "technological hazards", "radiological emergency", "chemical spills", "biological threats", "wildfire management", "floodplain management", "earthquake preparedness", "hurricane response", "tornado preparedness", "drought contingency", "infrastructure resilience", "risk communication", "early warning systems", "gis", "geographic information systems) in disaster management", "crisis mapping", "emergency alert system", "eas", "volunteer management", "donations management", "reconstruction", "financial assistance programs", "business continuity planning", "lessons learned"]
# climate_taxonomy = ["climate", "greenhouse gases", "carbon footprint", "climate change adaptation", "climate change mitigation", "renewable energy", "energy efficiency", "carbon pricing", "carbon markets", "emissions trading", "carbon offsets", "climate policy", "paris agreement", "unfccc", "united nations framework convention on climate change", "ipcc", "intergovernmental panel on climate change", "global warming", "sea level rise", "ocean acidification", "deforestation", "afforestation", "carbon sequestration", "climate resilience", "climate justice", "adaptation financing", "mitigation strategies", "climate models", "extreme weather events", "heat waves", "drought", "floods", "glacier retreat", "arctic amplification", "carbon capture and storage", "ccs", "bioenergy", "geothermal energy", "hydropower", "solar energy", "wind energy", "electric vehicles", "evs", "sustainable agriculture", "circular economy", "climate education", "climate communication", "climate technology", "climate finance", "climate impact assessment", "biodiversity loss", "urban heat island effect", "green building standards", "climate data", "climate action plans"]
# transportation_taxonomy = ["transportation", "highways", "road transportation", "traffic management", "traffic safety", "traffic congestion", "road signs and markings", "road maintenance", "bridges", "tunnels", "public transportation", "mass transit", "bus rapid transit", "brt", "subways and metro systems", "light rail transit", "lrt", "commuter rail", "ferry services", "aviation", "airports", "airlines", "air traffic control", "airport security", "rail transportation", "freight rail", "passenger rail", "high-speed rail", "intermodal transportation", "ports", "maritime shipping", "containerization", "inland waterways", "shipping", "logistics", "supply chain management", "last mile delivery", "electric vehicles", "evs", "autonomous vehicles", "avs", "connected vehicles", "smart transportation", "transportation infrastructure financing", "transportation planning", "transportation policy", "traffic engineering", "transportation demand management", "tdm", "intelligent transportation systems", "its", "environmental impact assessment", "eia", "transportation safety regulations", "road pricing", "vehicle emissions", "fuel efficiency", "alternative fuels"]
# environment_taxonomy = ["environment", "air quality", "water quality", "soil quality", "environmental impact assessment", "eia", "environmental regulations", "environmental policy", "environmental management systems", "ems", "sustainability", "climate change", "greenhouse gas emissions", "carbon footprint", "renewable energy", "energy efficiency", "waste management", "recycling", "hazardous waste", "pollution control", "clean water act", "clean air act", "endangered species", "biodiversity", "conservation", "natural resource management", "ecosystem services", "ecological restoration", "environmental monitoring", "environmental justice", "environmental education", "sustainable development goals", "sdgs", "circular economy", "green technologies", "low-carbon economy", "carbon sequestration", "ocean conservation", "marine protected areas", "mpas", "land use planning", "urban sustainability", "industrial ecology", "ecotourism", "sustainable agriculture", "environmental certification", "e.g., leed", "corporate social responsibility", "csr", "eco-labeling", "life cycle assessment", "lca", "environmental remediation", "sustainable fisheries", "wetland conservation", "forest management", "air pollution control", "water resource management"]
# aviation_taxonomy = ["aviation", "commercial aviation", "general aviation", "airlines", "airports", "airport operations", "air traffic control", "atc", "flight operations", "aircraft", "fixed-wing aircraft", "rotary-wing aircraft", "helicopters", "aircraft manufacturing", "aircraft design", "aircraft maintenance", "aviation safety", "flight safety", "aviation regulations", "international civil aviation organization", "icao", "federal aviation administration", "faa", "european union aviation safety agency", "easa", "aviation security", "airport security", "aviation fuel", "aviation weather", "airline operations", "airline alliances", "airline fleet", "airline routes", "airline revenue management", "passenger experience", "cabin crew", "pilot training", "flight planning", "aircraft leasing", "air cargo", "cargo aircraft", "unmanned aerial vehicles", "uavs", "drone operations", "aviation insurance", "aviation finance", "aviation law", "airline codeshare", "aviation maintenance repair and overhaul", "mro", "aviation noise", "aviation emissions", "aviation sustainability", "aviation accidents", "air traffic management", "atm", "airport infrastructure", "aviation communication", "aviation technology"]
# data_analytics_taxonomy = ["data analytics", "descriptive analytics", "predictive analytics", "prescriptive analytics", "diagnostic analytics", "data mining", "data visualization", "big data analytics", "machine learning", "artificial intelligence", "natural language processing", "time series analysis", "regression analysis", "classification", "clustering", "anomaly detection", "data warehousing", "etl", "extract, transform, load", "business intelligence", "data governance", "data quality", "data integration", "data modeling", "data lake", "data mart", "data pipeline", "data cleansing", "data transformation", "data enrichment", "data aggregation", "statistical analysis", "hypothesis testing", "a/b testing", "data sampling", "data imputation", "data segmentation", "feature engineering", "data normalization", "data standardization", "data encryption", "data masking", "data anonymization", "data auditing", "data lineage", "data catalog", "data stewardship", "data retention", "data archiving", "data recovery", "data privacy", "data security"]
# generative_ai_taxonomy = ["generative ai", "text generation", "image generation", "music generation", "video generation", "code generation", "natural language processing", "nlp", "transformer models", "generative adversarial networks", "gans", "variational autoencoders", "vaes", "reinforcement learning", "language models", "neural networks", "deep learning", "few-shot learning", "zero-shot learning", "transfer learning", "prompt engineering", "fine-tuning", "self-supervised learning", "unsupervised learning", "semi-supervised learning", "style transfer", "image super-resolution", "text-to-speech", "tts", "speech-to-text", "stt", "multimodal models", "text summarization", "text translation", "question answering", "conversational ai", "sentiment analysis", "emotion recognition", "content generation", "synthetic data", "data augmentation", "ethical ai", "bias mitigation", "model interpretability", "explainable ai", "xai", "human-ai interaction", "creativity in ai", "ai in art", "ai in writing", "ai in gaming", "ai in design", "ai in marketing", "ai in education", "ai in healthcare", "ai for accessibility", "ai ethics and governance"]
# cyber_security_taxonomy = ["cyber security", "network security", "information security", "endpoint security", "application security", "cloud security", "data security", "identity and access management", "iam", "threat intelligence", "vulnerability management", "security information and event management", "siem", "intrusion detection systems", "ids", "intrusion prevention systems", "ips", "firewalls", "antivirus and antimalware", "encryption", "data loss prevention", "dlp", "security operations center", "soc", "penetration testing", "incident response", "cyber threat hunting", "security orchestration, automation, and response", "soar", "zero trust architecture", "multi-factor authentication", "mfa", "public key infrastructure", "pki", "secure socket layer", "ssl) / transport layer security", "tls", "cyber risk management", "compliance management", "security policy management", "mobile security", "internet of things", "iot) security", "industrial control systems", "ics) security", "cyber forensics", "red teaming", "blue teaming", "purple teaming", "cybersecurity awareness training", "cyber hygiene", "security auditing", "phishing prevention", "ransomware protection", "social engineering defense", "insider threat management", "cyber resilience", "supply chain security", "endpoint detection and response", "edr", "managed detection and response", "mdr", "behavioral analytics", "advanced persistent threats", "apt) defense", "cybersecurity frameworks", "e.g., nist, iso/iec 27001", "security governance"]
# regulatory_policy_taxonomy = ["regulatory policy", "compliance management", "risk assessment", "regulatory compliance", "policy development", "regulatory affairs", "regulatory frameworks", "regulatory auditing", "compliance monitoring", "internal controls", "regulatory reporting", "policy implementation", "governance, risk, and compliance", "grc", "anti-money laundering", "aml", "know your customer", "kyc", "data protection regulations", "environmental regulations", "health and safety regulations", "financial regulations", "consumer protection regulations", "trade compliance", "export control regulations", "import regulations", "industry standards", "ethical standards", "legal compliance", "corporate governance", "compliance training", "compliance culture", "regulatory change management", "regulatory impact analysis", "regulatory liaison", "licensing and permits", "regulatory risk management", "quality assurance", "regulatory strategy", "regulatory technology", "regtech", "transparency regulations", "whistleblower protection", "privacy regulations", "anti-bribery and corruption", "abc", "cybersecurity regulations", "intellectual property regulations", "labor and employment regulations", "tax compliance", "competition law", "compliance analytics", "standards compliance", "sustainable compliance", "regulatory intelligence", "ethical compliance"]
# enterprise_cloud_solutions_taxonomy = ["enterprise cloud solutions", "infrastructure as a service", "iaas", "platform as a service", "paas", "software as a service", "saas", "cloud computing", "public cloud", "private cloud", "hybrid cloud", "multi-cloud", "cloud migration", "cloud management", "cloud security", "cloud storage", "cloud networking", "cloud databases", "cloud orchestration", "cloud automation", "cloud scalability", "cloud load balancing", "cloud backup", "disaster recovery as a service", "draas", "cloud cost management", "cloud compliance", "cloud monitoring", "cloud analytics", "cloud devops", "serverless computing", "edge computing", "containerization", "kubernetes", "microservices architecture", "api management", "identity and access management", "iam", "virtual private cloud", "vpc", "elasticity", "high availability", "fault tolerance", "cloud governance", "cloud service level agreements", "slas", "cloud integration", "cloud native applications", "cloud performance optimization", "content delivery network", "cdn", "virtual machines", "vms", "cloud app development", "cloud security posture management", "cspm", "unified endpoint management", "uem", "cloud collaboration tools", "managed cloud services", "cloud data encryption", "cloud innovation"]
# research_evaluation_taxonomy = ["research evaluation", "peer review", "bibliometrics", "scientometrics", "altmetrics", "citation analysis", "impact factor", "h-index", "research impact", "research quality assessment", "research productivity", "funding evaluation", "grant reviews", "publication analysis", "research metrics", "research output", "collaboration networks", "co-authorship analysis", "research influence", "research utilization", "research translation", "research dissemination", "knowledge transfer", "knowledge mobilization", "research uptake", "research ethics", "research governance", "research integrity", "research performance indicators", "research policy", "research strategy", "evaluation frameworks", "program evaluation", "outcome evaluation", "process evaluation", "formative evaluation", "summative evaluation", "qualitative evaluation", "quantitative evaluation", "mixed-methods evaluation", "logic models", "theory of change", "evaluation capacity building", "evaluation standards", "evaluation utilization", "stakeholder engagement", "evaluation reporting", "cost-benefit analysis", "cost-effectiveness analysis", "evaluation ethics", "evidence-based policy"]
# advisory_taxonomy = ["advisory", "management consulting", "financial advisory", "strategic planning", "business transformation", "risk management", "compliance advisory", "it consulting", "human resources consulting", "marketing consulting", "operations consulting", "supply chain management", "change management", "leadership development", "organizational development", "performance improvement", "merger and acquisition advisory", "due diligence", "restructuring advisory", "tax advisory", "wealth management", "investment advisory", "legal advisory", "environmental, social, and governance", "esg) advisory", "digital transformation", "innovation management", "corporate governance", "market entry strategy", "brand strategy", "customer experience", "cx) consulting", "cybersecurity advisory", "data analytics advisory", "economic advisory", "financial planning and analysis", "fp&a", "project management", "public relations advisory", "crisis management", "talent management", "technology strategy", "product development advisory", "sustainability advisory", "business continuity planning", "competitive analysis", "pricing strategy", "regulatory advisory", "audit and assurance services", "knowledge management", "procurement advisory", "training and development", "market research", "strategic sourcing"]
# public_health_taxonomy = ["public health", "epidemiology", "biostatistics", "health promotion", "disease prevention", "environmental health", "global health", "health policy", "health systems", "community health", "occupational health", "maternal and child health", "infectious disease control", "chronic disease management", "health education", "behavioral health", "social determinants of health", "health disparities", "public health surveillance", "vaccination programs", "health communication", "nutrition and dietetics", "mental health", "health equity", "emergency preparedness", "health economics", "health services research", "health informatics", "public health ethics", "health literacy", "public health law", "health advocacy", "sanitation and hygiene", "substance abuse prevention", "sexual and reproductive health", "injury prevention", "adolescent health", "aging and geriatrics", "public health genomics", "water quality", "air quality", "vector control", "food safety", "public health nursing", "public health administration", "risk assessment", "community outreach", "health impact assessment", "global health security", "public health nutrition", "program evaluation"]

custom_taxonomies = ["custom_taxonomy"]
custom_taxonomy = ['custom taxonomy', 'sustainability in it operations', 'startup ecosystem', 'climate change mitigation', 'cloud cost management', 'competitive analysis', 'it skills development', 'emergency preparedness', 'climate impact assessment', 'aviation weather', 'incident response', 'product launch', 'data anonymization', 'data lineage', 'international civil aviation organization', 'cloud security', 'electric vehicles', 'multi-factor authentication', 'startup valuation', 'microgrids', 'intellectual property regulations', 'venture partner', 'health maintenance organization', 'accountable care organization', 'energy efficiency', 'traffic congestion', 'industrial ecology', 'ambulatory surgical centers', 'protected health information', 'patent', 'emergency response', 'climate technology', 'cost-benefit analysis', 'startup accelerator', 'late-stage startup', 'startup law', 'quality payment program', 'airport infrastructure', 'business intelligence', 'customer retention', 'ferry services', 'value-based purchasing', 'atc', 'ipcc', 'energy audits', 'mass care', 'music generation', 'behavioral analytics', 'code generation', 'burn rate', 'managed detection and response', 'series c funding', 'power generation', 'aviation technology', 'cloud performance optimization', 'airline routes', 'a/b testing', 'cybersecurity awareness training', 'ems', 'public relations advisory', 'bootstrapping', 'energy transition', 'customer experience', 'remote healthcare services', 'ics) security', 'hazards', 'floods', 'highways', 'text translation', 'rps', 'endpoint security', 'risk communication', 'regulatory risk management', 'aviation finance', 'bridges', 'aviation emissions', 'emergency operations center', 'public health emergency', 'open data', 'its', 'environmental regulations', 'mixed-methods evaluation', 'vaccination programs', 'carbon pricing', 'snf', 'data imputation', 'customer acquisition', 'global health security', 'financial model', 'sea level rise', 'data aggregation', 'carbon capture and storage', 'data catalog', 'itsm', 'legal compliance', 'medicaid waivers', 'seed funding', 'indian health service', 'intelligent transportation systems', 'cloud backup', 'crisis management', 'seed round', 'energy consumption patterns', 'rail transportation', 'biodiversity', 'aml', 'microservices architecture', 'open source software adoption', 'sentiment analysis', 'health equity', 'climate action plans', 'environmental justice', 'ifc taxonomies', 'cloud service level agreements', 'fault tolerance', 'evaluation frameworks', 'maternal and child health', 'leadership', 'disaster recovery as a service', 'national response framework', 'air traffic control', 'phi', 'disaster recovery planning', 'cloud analytics', 'iaas', 'publication analysis', 'angel funding', 'fqhc', 'merit-based incentive payment system', 'energy education and awareness', 'management consulting', 'federal health', 'electronic health records', 'vaes', 'apt) defense', 'health communication', 'ai', 'theory of change', 'corporate social responsibility', 'early warning systems', 'enterprise cloud solutions', 'environmental impact assessment', 'mdr', 'flight safety', 'data governance', 'research dissemination', 'water quality', 'ransomware protection', 'ecotourism', 'road pricing', 'long-term care', 'revenue-based financing', 'managed cloud services', 'operations consulting', 'e.g., nist, iso/iec 27001', 'limited partner', 'engineer', 'pfa', 'bundled payments for care improvement', 'cybersecurity advisory', 'liquefied natural gas', 'collaboration networks', 'ccs', 'techstars', 'high availability', 'consolidated omnibus budget reconciliation act', 'revenue model', 'urban sustainability', 'hypothesis testing', 'transfer learning', 'self-supervised learning', 'urban heat island effect', 'ai ethics and governance', 'health information exchange', 'patient safety', 'vpc', 'angel round', 'scaling', 'preferred provider organization', 'partnership', 'social determinants of health', 'clean water act', 'evaluation reporting', 'substance abuse prevention', 'atm', 'serverless computing', 'afforestation', 'pitch competition', 'valuation cap', 'biostatistics', 'health economics', 'founder', 'last mile delivery', 'environmental certification', 'aviation noise', 'impact factor', 'energy supply chain', 'human-ai interaction', 'growth capital', 'compliance management', 'quantum computing', 'edr', 'greentech', 'secure coding practices', 'industry standards', 'anomaly detection', 'cybersecurity regulations', 'networking events', 'climate change', 'quantitative evaluation', 'oil and gas exploration', 'road maintenance', 'ai in art', 'formative evaluation', 'pitch deck', 'limited liability company (llc)', 'funding mechanisms for healthcare services', 'greenhouse gases', 'aircraft design', 'ids', 'cap table', 'commercial aviation', 'private equity', 'series a funding', 'measures to prevent harm in healthcare settings', 'commuter rail', 'iot) security', 'air quality', 'sustainable development goals', 'profit margin', 'economic and social factors influencing health', 'federal it modernization', 'community outreach', 'lessons learned', 'pqrs', 'bioenergy', 'climate data', 'equity', 'aviation maintenance repair and overhaul', 'cybersecurity frameworks', 'vendor management', 'energy innovation', 'hipaa', 'patent filing', 'hazardous waste', 'time series analysis', 'encryption', 'data mart', 'peer review', 'health insurance continuation', 'market entry strategy', 'air pollution control', 'model interpretability', 'pki', 'capital raise', 'energy security', 'xai', 'passenger experience', 'program evaluation', 'data center consolidation', 'life cycle assessment', 'centers for medicare & medicaid services', 'resilience', 'lrt', 'cloud orchestration', 'public health nursing', 'human resources consulting', 'regulatory strategy', 'biomass energy', '340b program', 'transportation policy', 'public cloud', 'data encryption', 'vms', 'hmo', 'mci', 'connected vehicles', 'sdgs', 'transportation safety regulations', 'corporation', 'sustainable energy', 'user experience (ux)', 'cloud native applications', 'devops', 'biodiversity loss', 'cms', 'aircraft manufacturing', 'drone operations', 'data visualization', 'security information and event management', 'public health nutrition', 'energy governance', 'health literacy', 'radiological emergency', 'financial advisory', 'energy storage', 'data lake', 'text generation', 'readiness for health emergencies', 'biological threats', 'hurricane response', 'qpp', 'energy independence', 'citizen-centric services', 'hydropower', 'cybersecurity', 'alternative fuels', 'aviation fuel', 'cyber risk management', 'statistical analysis', 'data warehousing', 'mass casualty incident', 'zero trust architecture', 'cyber forensics', 'cloud storage', 'adaptation financing', 'traction', 'bias mitigation', 'cloud migration', 'recycling', 'airline operations', 'evaluation ethics', 'evidence-based policy', 'research translation', 'illegal practices in the healthcare system', 'multi-cloud', 'solar energy', 'performance improvement', 'security operations center', 'export control regulations', 'cloud innovation', 'etl', 'cloud compliance', 'it service management', 'chip', 'trade compliance', 'regtech', 'sustainable compliance', 'damage assessment', 'scalability and elasticity', 'y combinator', 'transportation', 'nih', 'road signs and markings', 'conservation', 'identity and access management', 'ihs', 'regulatory change management', 'public health', 'food safety', 'incident command system', 'environmental policy', 'health outcomes of a group of individuals', 'social media strategy', 'aviation accidents', 'air cargo', 'drought contingency', 'research influence', 'infectious disease control', 'data integration', 'paris agreement', 'scientist', 'variational autoencoders', 'iam', 'series b funding', 'risk assessment', 'gis', 'united nations framework convention on climate change', 'cdc', 'risk management', 'api management', 'employment agreement', 'cargo aircraft', 'aircraft leasing', 'climate resilience', 'enterprise architecture', 'opioid epidemic', 'heat waves', 'mfa', 'fp&a', 'prescriptive analytics', 'venture round', 'funding round', 'extreme weather events', 'data modeling', 'software as a service', 'regulatory affairs', 'change management', 'series a/b/c funding', 'citation analysis', 'airline codeshare', 'natural resource management', 'security policy management', 'software as a service (saas)', 'energy diplomacy', 'carbon offsets', 'lng', 'volunteer management', 'traffic safety', 'public health surveillance', 'data analytics advisory', 'macra', 'startup advisor', 'carbon markets', 'virtual machines', 'ics', 'vulnerability', 'intermodal transportation', 'water resource management', 'diagnostic analytics', 'wind energy', 'reconstruction', 'shipping', 'nutrition and dietetics', 'data segmentation', 'forest management', 'aviation insurance', 'climate finance', 'cloud governance', 'startup', 'multimodal models', 'leadership development', 'saas', 'demand response', 'data normalization', 'distributed energy resources', 'mitigation strategies', 'flight planning', 'health policy', 'network security', 'know your customer', 'blockchain technology', 'cloud computing', 'mobile security', 'organizational development', 'icao', 'disaster communications', 'abc', 'penetration testing', 'family and friends round', 'legacy system modernization', 'legislation related to mental health coverage', 'green technologies', 'current procedural terminology', 'fundraising', 'secure socket layer', 'social engineering defense', 'cyber resilience', 'cloud management', 'research uptake', 'skilled nursing facility', 'endpoint detection and response', 'it consulting', 'healthtech', 'sales strategy', 'airline revenue management', 'startup mentor', 'cpt codes', 'ocean conservation', 'unmanned aerial vehicles', 'regulatory frameworks', 'community health', 'data augmentation', 'vector control', 'bpci', 'mips', 'vehicle emissions', 'financial planning and analysis', 'sanitation and hygiene', 'image super-resolution', 'customer segmentation', 'contract negotiation', 'generative ai', 'elasticity', 'hhs', 'few-shot learning', 'avs', 'data recovery', 'break-even point', 'telehealth', 'corporate governance', 'energy access', 'vulnerability management', 'cloud data encryption', 'inland waterways', 'behavioral health', 'language models', 'business continuity planning', 'growth hacking', 'tax advisory', 'intellectual property (ip)', 'infrastructure resilience', 'natural gas', 'wildfire management', 'content delivery network', 'cloud load balancing', 'h-index', 'marketing strategy', 'transportation infrastructure financing', 'mass transit', 'maritime shipping', 'hcpcs codes', 'gans', 'climate education', 'cloud networking', 'drgs', 'epidemiology', 'aircraft maintenance', 'fintech', 'equity financing', 'industrial control systems', 'privacy regulations', 'due diligence', 'business development', 'process evaluation', 'renewable energy', 'evaluation standards', 'lca', 'venture capitalist', 'csr', 'conversational ai', 'nlp', 'smart transportation', 'autonomous vehicles', 'consumer protection regulations', 'environmental, social, and governance', 'traffic engineering', 'internal controls', 'emissions trading', 'stock options', 'disaster declaration', 'market disruption', 'non-disclosure agreement (nda)', 'research impact', 'synthetic data', 'drug pricing program', 'energy management systems', 'security governance', 'ipo', 'user acquisition', '5g network integration', 'health informatics', 'climate change adaptation', 'robotic process automation', 'bus rapid transit', 'cloud security posture management', 'scientometrics', 'technology strategy', 'market analysis', 'carbon footprint', 'arctic amplification', 'research ethics', 'e.g., leed', 'advanced persistent threats', 'rpa', 'market fit', 'continuous monitoring', 'national drug codes', 'glacier retreat', 'geospatial data', 'proof of concept', 'nrf', 'mpas', 'mental health parity act', 'go-to-market strategy', 'merger and acquisition advisory', 'accelerator', 'data sampling', 'big data analytics', 'angel investor', 'siem', 'coal and coal technologies', 'advisor', 'minimal viable product (mvp)', 'crisis mapping', 'european union aviation safety agency', 'cloud collaboration tools', 'health advocacy', 'renewable portfolio standards', 'food and drug administration', 'medicare part a/b/c/d', 'aviation sustainability', 'pilot training', 'diagnosis-related groups', 'pricing strategy', 'health promotion', 'health disparities', 'data stewardship', 'under medicare part d', 'mental health', 'research metrics', 'governance, risk, and compliance', 'policy implementation', 'tunnels', 'virtual private cloud', 'physician quality reporting system', 'descriptive analytics', 'pre-seed funding', 'health services research', 'demo day', 'traffic management', 'ssl) / transport layer security', 'cloud databases', 'blue teaming', 'research performance indicators', 'digital marketing', 'air traffic management', 'data security', 'data archiving', 'advisory', 'anti-bribery and corruption', 'qualitative evaluation', 'mro', 'quality assurance', 'energy financing', 'occupational health', 'geothermal energy', 'data transformation', 'department of health and human services', 'low-carbon economy', 'draas', 'research utilization', 'population health', 'series d funding', 'serial entrepreneur', 'emotion recognition', 'ips', 'bibliometrics', 'security orchestration, automation, and response', 'project management', 'regulatory advisory', 'kubernetes', 'helicopters', 'platform as a service (paas)', 'uavs', 'clinical modification', 'entrepreneur', 'intrusion prevention systems', 'research evaluation', 'regulatory policy', 'passenger rail', 'uem', 'energy conservation', 'energy trading', 'shelter management', 'solar power', 'aircraft', 'startup competition', 'airports', 'various services and facilities', 'semi-supervised learning', 'knowledge management', 'regulatory compliance', 'security auditing', 'public key infrastructure', 'ndc codes', 'transparency regulations', 'summative evaluation', 'innovation', 'ai in marketing', 'aviation communication', 'data auditing', 'information security', 'altmetrics', 'ppo', 'deforestation', 'subways and metro systems', 'staff development', 'various medicaid waiver programs', 'stt', 'research productivity', 'sustainability advisory', 'chemical spills', 'healthcare fraud', 'data mining', 'early-stage startup', 'pollution control', 'airport operations', 'startup incubator', 'series e funding', 'prototype', 'entrepreneurship', 'health information technology for economic and clinical health act', 'insider threat management', 'outcome evaluation', 'public health emergency preparedness', 'policy development', 'research policy', 'it procurement and acquisition', 'data privacy', 'waste management', 'ethical ai', 'agile development', 'internet of things', 'trademark registration', 'sharing of electronic health information', 'environmental monitoring', 'knowledge mobilization', 'triage', 'medicare access and chip reauthorization act', 'data enrichment', 'unsupervised learning', 'text-to-speech', 'application security', 'supply chain security', 'cloud automation', 'geographic information systems) in disaster management', 'import regulations', 'virtualization', 'procurement advisory', 'centers for disease control and prevention', 'crowdfunding', 'unique selling proposition (usp)', 'business model', 'transportation demand management', 'disruptive technology', 'regression analysis', 'psychological first aid', 'energy economics', 'shale gas', 'tls', 'zero-shot learning', 'edtech', 'regulatory liaison', 'land use planning', 'tts', 'marine protected areas', 'regulatory auditing', 'infrastructure as a service (iaas)', 'esg) advisory', 'research quality assessment', 'disease prevention', 'purple teaming', 'energy risk management', 'eco-labeling', 'exit strategy', 'data protection regulations', 'compliance training', 'cx) consulting', 'disaster mitigation', 'critical infrastructure', 'fixed-wing aircraft', 'standards compliance', 'investment advisory', 'shares', 'high-speed rail', 'board member', "children's health insurance program", 'supply chain management', 'red teaming', 'stakeholder engagement', 'regulatory impact analysis', 'technological hazards', 'strategic planning', 'ocean acidification', 'compliance monitoring', 'chronic disease management', 'flight operations', 'value proposition', 'aviation', 'software defined networking', 'energy infrastructure', 'smart grids', 'data analytics', 'business process reengineering', 'performance engineering', 'innovation management', 'environment', 'cdn', 'evaluation utilization', 'eas', 'drought', 'environmental education', 'faa', 'generative adversarial networks', 'research integrity', 'knowledge transfer', 'ecosystem services', 'climate models', 'health insurance portability and accountability act', 'evs', 'transformer models', 'competition law', 'health systems', 'energy regulatory framework', 'classification', 'earthquake preparedness', 'sustainable agriculture', 'cspm', 'data loss prevention', 'vesting schedule', 'funding evaluation', 'global warming', 'startup community', 'va health system', 'climate', 'dlp', 'it budgeting and cost management', 'rotary-wing aircraft', 'team building', 'venture funding', 'business accelerator', 'healthcare common procedure coding system', 'easa', 'slas', 'greenhouse gas emissions', 'energy justice', 'text summarization', 'anti-money laundering', 'fda', 'healthcare financing', 'cyber threat hunting', 'infrastructure as a service', 'eoc', 'ai for accessibility', 'ai in design', 'veterans affairs health services', 'pdp', 'tdm', 'energy', 'venture capital', 'video generation', 'crisis related to opioid misuse', 'term sheet', 'man-made disasters', 'data pipeline', 'cloud devops', 'co-working space', 'intellectual property rights', 'neural networks', 'debt financing', 'understanding of health information', 'product development', 'restructuring advisory', 'product development advisory', 'regulatory reporting', 'health impact assessment', 'energy resilience', 'cyber hygiene', 'rmf', 'endangered species', 'global health', 'employee hiring', 'natural disasters', 'data standardization', 'shareholder agreement', 'remote work', 'antivirus and antimalware', 'eia', 'soar', 'performance review', 'whistleblower protection', 'deep learning', 'federal aviation administration', 'aviation law', 'differences in health outcomes among populations', 'licensing and permits', 'natural language processing', 'grc', 'mvp', 'equal access to healthcare services', 'evacuation', 'medical surge', 'climate justice', 'airline fleet', 'strategic sourcing', 'management', 'startup culture', 'containerization', 'airlines', 'cobra', 'legal advisory', 'brand strategy', 'compliance culture', 'tax compliance', 'medicare program parts', 'user interface (ui)', 'aviation safety', 'paas', 'trademark', 'airline alliances', 'question answering', 'research governance', 'incorporation', 'logistics', 'investor', 'business', 'clean air act', 'sustainable fisheries', 'user-centered design', 'aco', 'convertible note', 'public transportation', 'machine learning', 'disaster recovery', 'emergency alert system', 'data masking', 'sweat equity', 'incubator', 'carbon sequestration', 'creativity in ai', 'ai in writing', 'financial regulations', 'public health ethics', 'soil quality', 'platform as a service', 'standards to assess healthcare performance', 'predictive analytics', 'ai in education', 'tech stack', 'health and safety regulations', 'private cloud', 'cloud monitoring', 'intrusion detection systems', 'seed capital', 'public health law', 'it infrastructure optimization', 'community resilience', 'environmental remediation', 'firewalls', 'sdn', 'marketing consulting', 'evaluation capacity building', 'soc', 'business plan', 'talent acquisition', 'aviation security', 'wetland conservation', 'data retention', 'prompt engineering', 'labor and employment regulations', 'general partner', 'image generation', 'adolescent health', 'logic models', 'clustering', 'injury prevention', 'talent management', 'cabin crew', 'hitech act', 'startup office', 'aging and geriatrics', 'kyc', 'co-authorship analysis', 'energy policy', 'data cleansing', 'skills training', 'battery technologies', 'reinforcement learning', 'public health administration', 'fuel efficiency', 'sustainability', 'cloud integration', 'ai in healthcare', 'compliance analytics', 'cost-effectiveness analysis', 'compliance advisory', 'training and development', 'equity stake', 'wealth management', 'lean startup', 'iot', 'environmental health', 'public health genomics', 'financial assistance programs', 'outpatient surgical facilities', 'intergovernmental panel on climate change', 'run rate', 'circular economy', 'floodplain management', 'national institutes of health', 'green building standards', 'extract, transform, load', 'speech-to-text', 'federally qualified health center', 'environmental management systems', 'threat intelligence', 'donations management', 'climate communication', 'energy demand forecasting', 'unfccc', 'ethical standards', 'ethical compliance', 'research strategy', 'research output', 'road transportation', 'edge computing', 'prescription drug plan', 'search and rescue', 'airport security', 'artificial intelligence', 'general aviation', 'hybrid cloud', 'aviation regulations', 'health education', 'industry conference', 'sexual and reproductive health', 'explainable ai', 'nuclear power', 'transportation planning', 'pivot', 'unified endpoint management', 'audit and assurance services', 'minimum viable product', 'vbp', 'freight rail', 'cyber security', 'ai in gaming', 'brt', 'cloud app development', 'feature engineering', 'home health services', 'grant reviews', 'ecological restoration', 'content generation', 'mobile application development', 'ports', 'phishing prevention', 'proptech', 'startup pitch', 'risk management framework', 'tornado preparedness', 'business transformation', 'fine-tuning', 'market research', 'data quality', 'climate policy', 'venture debt', 'digital transformation', 'ehr', 'economic advisory', 'cloud scalability', 'medicare-covered home health services', 'ders', 'disaster management', 'sar', 'grid modernization', 'healthcare quality measures', 'organizational culture', 'energy markets', 'regulatory intelligence', 'mvp (minimum viable product)', 'light rail transit', 'regulatory technology', 'style transfer', 'mezzanine financing', 'social vulnerability', 'microservices', 'equity crowdfunding']

"""## Flair Code Block"""

def for_doccano_pre_tagging(single_line_paragraph):
  sentence = Sentence(single_line_paragraph)
  tagger.predict(sentence)
  entities = []
  for entity in sentence.get_spans('ner'):
    entities.append([entity.start_position, entity.end_position, entity.labels[0].value])

  results = programatic_taxonomy_detection(single_line_paragraph, startup_taxonomy)
  for result in results:
    entities.append([result['BeginOffset'], result['EndOffset'], result['Type']])

  response = {"text": single_line_paragraph, "label": entities}
  return response

def standardize_entity_text(entity_text, entity_type):
  # p = inflect.engine()
  
  # reduce both entity_text and entity_type to lowercase
  entity_text = entity_text.lower()
  entity_type = entity_type.lower()

  # # if entity_text is plural, convert it to singular
  # if p.singular_noun(entity_text):
  #   entity_text = p.singular_noun(entity_text)

  # remove any leading or trailing whitespaces
  entity_text = entity_text.strip()

  # remove any leading or trailing single or double quotes
  entity_text = entity_text.strip("'")
  entity_text = entity_text.strip('"')

  # remove any occurance of single or double quotes
  entity_text = entity_text.replace("'", "")
  entity_text = entity_text.replace('"', '')

  return entity_text, entity_type

def for_ingestion_pipeline(single_line_paragraph):
  entities, entity_text_only, entity_type_only = [], [], []
  cannonical_map = {}

  # get entities from Vanilla Flair (ner-ontonotes-large model)
  sentence = Sentence(single_line_paragraph)
  tagger.predict(sentence)
  for entity in sentence.get_spans('ner'):
    entity_text_temp = entity.text
    entity_type_temp = entity.labels[0].value

    # if entity_text_temp is 'cardinal' or 'ordinal', skip it
    if entity_type_temp == 'CARDINAL' or entity_type_temp == 'ORDINAL':
      continue

    entity_text_temp, entity_type_temp = standardize_entity_text(entity_text_temp, entity_type_temp)

    entity_text_with_type = entity_text_temp + " (" + entity_type_temp + ")"
    # entity_text_with_type = entity_text_with_type.replace("'", "") # replace all occurances of single and double quotes
    entities.append(entity_text_with_type)

    if entity_text_temp not in entity_text_only:
      entity_text_only.append(entity_text_temp)

    if entity_type_temp not in entity_type_only:
      entity_type_only.append(entity_type_temp)

    if entity_type_temp in cannonical_map:
      if entity_text_temp not in cannonical_map[entity_type_temp]:
        cannonical_map[entity_type_temp].append(entity_text_temp)
    else:
      cannonical_map[entity_type_temp] = [entity_text_temp]

  # results = programatic_taxonomy_detection(single_line_paragraph, startup_taxonomy)
  results = programatic_taxonomy_detection(single_line_paragraph, custom_taxonomy)

  for result in results:
    entity_text_temp = result['Text']
    entity_type_temp = result['Type']

    entity_text_temp, entity_type_temp = standardize_entity_text(entity_text_temp, entity_type_temp)

    entity_text_with_type = entity_text_temp + " (" + entity_type_temp + ")"
    entities.append(entity_text_with_type)

    if entity_text_temp not in entity_text_only:
      entity_text_only.append(entity_text_temp)

    if entity_type_temp not in entity_type_only:
      entity_type_only.append(entity_type_temp)

    if entity_type_temp in cannonical_map:
      if entity_text_temp not in cannonical_map[entity_type_temp]:
        cannonical_map[entity_type_temp].append(entity_text_temp)
    else:
      cannonical_map[entity_type_temp] = [entity_text_temp]

  # for taxonomy in custom_taxonomies:
  #   results = programatic_taxonomy_detection(single_line_paragraph, globals()[taxonomy])
  #   for result in results:
  #     entity_text_temp = result['Text']
  #     entity_type_temp = result['Type']

  #     entity_text_temp, entity_type_temp = standardize_entity_text(entity_text_temp, entity_type_temp)

  #     entity_text_with_type = entity_text_temp + " (" + entity_type_temp + ")"
  #     entities.append(entity_text_with_type)

  #     if entity_text_temp not in entity_text_only:
  #       entity_text_only.append(entity_text_temp)

  #     if entity_type_temp not in entity_type_only:
  #       entity_type_only.append(entity_type_temp)

  #     if entity_type_temp in cannonical_map:
  #       if entity_text_temp not in cannonical_map[entity_type_temp]:
  #         cannonical_map[entity_type_temp].append(entity_text_temp)
  #     else:
  #       cannonical_map[entity_type_temp] = [entity_text_temp]

  entities = list(set(entities))
  response = {"Entities": entities, "EntityTextOnly": entity_text_only, "EntityTypeOnly": entity_type_only, "CannonicalMap": cannonical_map}
  return response

"""## Flask Code Block"""

app = Flask(__name__)

@app.route('/', methods=["POST"])
def hello():
  data = request.get_json()
  text = data['text']
  recognized_entities = {"warning": "This is not an active/production endpoint. Production enpoints include 'ingestion_pipeline' and 'doccano_pre_annotation'"}
  recognized_entities = jsonify(recognized_entities) # essential because returning a dictionary directly from a Flask route does not automatically convert it to a JSON response
  return recognized_entities

@app.route('/doccano_pre_annotation', methods=["POST"])
def doccano_pre_annotation():
  data = request.get_json()
  text = data['text']
  recognized_entities = for_doccano_pre_tagging(text) # for doccano pre-annotation of text
  recognized_entities = jsonify(recognized_entities) # essential because returning a dictionary directly from a Flask route does not automatically convert it to a JSON response

  # debug prints start
  print("Input Text in body:", text)
  print("Recognized Entities Object:", recognized_entities)
  print("Recognized Entities Object Type:", type(recognized_entities))
  print("Recognized Entities JSON Contents:", recognized_entities.json)
  print("\n\n")
  # debug prints end
  return recognized_entities

@app.route('/ingestion_pipeline', methods=["POST"])
def ingestion_pipeline():
  data = request.get_json()
  text = data['text']
  recognized_entities = for_ingestion_pipeline(text) # for ingestion pipeline
  recognized_entities = jsonify(recognized_entities) # essential because returning a dictionary directly from a Flask route does not automatically convert it to a JSON response

  # debug prints start
  print("\nInput Text in body:", text)
  # print("Recognized Entities Object:", recognized_entities)
  # print("Recognized Entities Object Type:", type(recognized_entities))
  print("Recognized Entities JSON Contents:", recognized_entities.json)
  # print("\n\n")
  # debug prints end
  return recognized_entities

@app.route('/err', methods=["POST"])
def err():
  data = request.get_json()
  text = data['text']
  non_redundant_entity = classify_entities(text)
  non_redundant_entity = jsonify(non_redundant_entity) # essential because returning a dictionary directly from a Flask route does not automatically convert it to a JSON response
  return non_redundant_entity